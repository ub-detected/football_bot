# FootWow - telegram MiniApp, предназначенный для организации товарищеских футбольных матчей.

FootWow - мини-приложение Telegram, полезное для любителей дворового футбола. Приложение позволяет пользователям организовывать и участвовать в футбольных матчах, вести статистику, формировать команды. Далее описана архитектура, инструкции по запуску и немного о самом проекте.

## Содержание

* [Актуальность](#актуальность)
* [Цели проекта](#цели-проекта)
* [Функциональные требования от каждого участника](#функциональные-требования)
* [Архитектура решения](#архитектура-решения)
* [Компоненты системы](#компоненты-системы)
* [Модели данных](#модели-данных)
* [Ключевые механизмы](#ключевые-механизмы)
* [Инструкция по запуску](#инструкция-по-запуску)
* [Планы на будущее](#планы-на-будущее)

## Актуальность
У каждого любителя попинать мяч бывало в жизни такое: хочешь поиграть в футбол, а во дворе никого нет, начинаешь писать друзьям, спрашивать, есть ли планы, а они то не отвечают, то забывают о вашей договоренности. Так что организация футбольного матча действительно нелегкое дело: бесконечные переписки (иногда с выяснениями отношений), путаница с составами, споры о результатах... FootWow решает эти проблемы раз и навсегда!

## Цели проекта

Основные цели проекта:
* Упростить процесс организации футбольных игр
* Автоматизировать формирование команд и выбор капитанов
* Создать прозрачную систему учета статистики и рейтинга игроков
* Интегрировать все функции прямо в Telegram через Mini Apps API

## Функциональные требования
### Docker

1. Контейнеризация приложения
Разделение на несколько контейнеров (backend, frontend)
2. Использование Docker Compose для управления сервисами
3. CI/CD

### Frontend

1. Разделение логики на компоненты и страницы (ключевые страницы: лента игр (Games), комната игры (GameRoom), личный профиль (Profile), таблица лидеров (Leaderboard))
2. Поддержка светлой/темной темы
3. Оптимизированная сборка через vite
4. Создание страницы комнаты игры (GameRoom), на которой будут детали матча, управления составами
5. Создание функций для GameRoom, чтобы пользователь мог присоединиться к игре, покинуть ее и т.д.
## Архитектура решения

FootWow построен по принципу клиент-серверной архитектуры с разделением на независимые компоненты:

### Фронтенд (TG_miniApp_front)
- **Язык:** TypeScript (в основном)
- **Фреймворк:** React
- **Сборка:** Vite
- **Стили:** TailwindCSS (для адаптивного дизайна)
- **Маршрутизация:** React Router
- **Интеграция с Telegram: (API)** Telegram Web App API

### Бэкенд (TG_miniApp_back)
- **Язык:** Python
- **Фреймворк:** Flask
- **База данных:** PostgreSQL
- **ORM**: SQLAlchemy
- **Миграции:** Flask-Migrate
- **CORS:** Flask-CORS

## Структура проекта

```
footbot/
├── TG_miniApp_front/           # Фронтенд
│   ├── src/
│   │   ├── components/         # UI компоненты
│   │   │   ├── Navigation.tsx  # Навигационная панель
│   │   │   ├── ThemeToggle.tsx # Переключатель темы
│   │   │   └── ...
│   │   ├── pages/              # Страницы приложения
│   │   │   ├── Games.tsx       # Страница игр
│   │   │   ├── GameRoom.tsx    # Детали игровой комнаты
│   │   │   ├── Leaderboard.tsx # Таблица лидеров
│   │   │   └── Profile.tsx     # Профиль пользователя
│   │   ├── api.ts              # API клиент
│   │   ├── types.ts            # TypeScript типы
│   │   ├── App.tsx             # Корневой компонент приложения
│   │   └── main.tsx            # Точка входа
│   └── ...
└── TG_miniApp_back/            # Бэкенд
    ├── main.py                 # Основной файл приложения
    ├── locations.py            # Данные о локациях
    ├── migrations/             # Миграции базы данных
    └── ...
├── Dockerfile         # Конфигурация Docker
├── docker-compose.yml # Конфигурация Docker Compose
├── .env               # Файл переменных окружения
└── package.json       # Зависимости проекта
```

## Компоненты системы

### Компоненты фронтенда
* **Страницы**:
  * Games - поиск и создание игровых комнат
  * GameRoom - детали конкретной игровой комнаты
  * Leaderboard - таблица лидеров с рейтингом игроков
  * Profile - профиль пользователя и его статистика

* **Ключевые компоненты UI**:
  * ThemeSwitch - переключатель светлой/темной темы
  * GameHistoryList - список прошедших игр с результатами
  * Navigation - навигационная панель приложения

### Компоненты бэкенда
* **Модели данных** - описывают структуру БД и бизнес-логику
* **API endpoints** - обрабатывают запросы от клиента
* **Сервисные функции** - реализуют бизнес-логику
* **Поиск локаций** - механизм интеллектуального поиска мест для игр

## Модели данных

### Пользователь (User)
- ID
- Имя пользователя
- URL фото
- Очки
- Количество игр
- Количество побед
- Настройки темы оформления

### Игровая комната (GameRoom)
- ID
- Название
- Создатель
- Максимальное количество игроков
- Локация
- Временной диапазон
- Статус (ожидание, выбор команд, в процессе, ввод счета, завершена)
- Игроки команд А и B
- Капитаны команд
- Счет команд
- Статус ввода счета

### История игр (GameHistory)
- ID
- Пользователь
- Игровая комната
- Победитель
- Команда
- Счет
- Роль капитана
- Результат
- Заработанные очки
- Дата игры
- Время начала и конца игры

## Ключевые механизмы

### Жизненный цикл игры

1. **Создание игры**
   * Пользователь создает игровую комнату, указывая название, место и время проведения
   * Другие игроки могут присоединиться к комнате через поиск или прямую ссылку

2. **Формирование команд**
   * Создатель комнаты запускает процесс формирования команд
   * Система автоматически распределяет игроков по командам и назначает капитанов
   * Капитаны могут менять составы команд (опционально)

3. **Проведение игры**
   * Команды проводят игру в реальности
   * Капитаны отмечают начало и окончание игры в приложении

4. **Ввод результатов**
   * Капитаны вводят итоговый счет матча
   * Если счет совпадает - игра считается завершенной
   * При несовпадении счета срабатывает механизм разрешения конфликтов

5. **Обновление статистики** 
   * Система автоматически обновляет рейтинги всех участников
   * Игра добавляется в историю для каждого игрока

### Система рейтинга

Рейтинг игроков рассчитывается по формуле, учитывающей:
* Результат матча (победа/поражение/ничья)
* Разницу в силе команд
* Индивидуальный вклад игрока (баланс по истории игр)
* Штрафы за нарушения (например, несоответствие счета)

```python
# Пример расчета рейтинга (упрощенно)
points_earned = base_win_points * (1 - expected_win_probability)
points_earned += score_difference * score_diff_coef
points_earned *= player_contribution
```

## Инструкция по запуску

### Требования
- Python 3.8+
- Node.js 16+
- npm или yarn
- PostgreSQL
- Docker
- Docker Compose

1. Переходим в папку бэкенда:
   ```bash
   cd footbot/TG_miniApp_back
   ```

2. Создаем виртуальное окружение:
   ```bash
   python -m venv venv
   
   # Windows
   venv\Scripts\activate
   
   # Linux/Mac
   source venv/bin/activate
   ```

3. Устанавливаем зависимости:
   ```bash
   pip install -r requirements.txt

4. Настройка базы данных

```bash
   # Создаем .env файл с параметрами подключения
   echo "DATABASE_URL=postgresql://username:password@localhost/footbot" > .env
   
   # Применяем миграции
   flask db upgrade
   
   # Заполняем тестовыми данными
   flask init-db
   ```

5. Запускаем сервер:
   ```bash
   flask run --debug
   ```

6. Переходим в папку фронтенда:
   ```bash
   cd footbot/TG_miniApp_front
   ```

7. Устанавливаем зависимости:
   ```bash
   npm install
   ```
8. Запускаем приложение:
   ```bash
   npm run dev
   ```
### Альтернатива:

1. Настройте среду разработки: клонируйте репозиторий, перейдите в папку репозитория:
 ```bash
git clone <repository-url>
cd footbot
```

2. Соберите образ в командной строке с помощью следующего скрипта (замените название на желаемое имя):

```bash
docker build -t *название* 
```

3. Запустите docker контейнер (укажите нужный порт, например 8080)
```bash
docker run -p *порт* *название*
```

## Планы на будущее

- **Геолокация** - автоматический поиск ближайших площадок
- **Интеграция оплаты** - возможность сбрасываться на аренду поля прямо в приложении
- **Турниры** - организация и проведение мини-турниров 
- **Достижения** - система наград за спортивные достижения
- **Статистика матчей** - детальная статистика по каждой игре
- **Статистика игроков** - детальная статистика по каждому игроку (количество передач, голевых, голов)

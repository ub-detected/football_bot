# FootBot - Платформа для организации футбольных игр

## Обзор проекта

FootBot - это комплексное веб-приложение, разработанное как мини-приложение для Telegram, которое позволяет пользователям организовывать и участвовать в футбольных играх. Платформа предоставляет удобный интерфейс для создания игровых комнат, формирования команд, ведения счета игр и отслеживания статистики игроков.

![FootBot Screenshot](https://placeholder-for-screenshot.com)

## Основные возможности

- **Создание и управление играми**
  - Создание игровых комнат с указанием места, времени и максимального количества игроков
  - Присоединение к существующим игровым комнатам
  - Формирование команд с выбором капитанов

- **Система подсчета очков**
  - Ввод счета в конце игры
  - Проверка согласованности счета между капитанами команд
  - Штрафы за несоответствие вводимого счета

- **Отслеживание статистики**
  - Персональная статистика игрока (игры, победы, очки)
  - Таблица лидеров с рейтингом всех игроков
  - История игр с подробной информацией

- **Дополнительные функции**
  - Выбор темы оформления (светлая/темная)
  - Система жалоб на игроков
  - Автодополнение при выборе локации

## Технический стек

### Фронтенд (TG_miniApp_front)
- **Язык:** TypeScript
- **Фреймворк:** React
- **Сборщик:** Vite
- **Стилизация:** TailwindCSS
- **Маршрутизация:** React Router
- **Интеграция с Telegram:** Telegram Web App API

### Бэкенд (TG_miniApp_back)
- **Язык:** Python
- **Фреймворк:** Flask
- **База данных:** PostgreSQL с SQLAlchemy (ORM)
- **Миграции:** Flask-Migrate
- **CORS:** Flask-CORS

## Структура проекта

```
footbot/
├── TG_miniApp_front/           # Фронтенд на React/TypeScript
│   ├── src/
│   │   ├── components/         # UI компоненты
│   │   │   ├── Navigation.tsx  # Навигационная панель
│   │   │   ├── ThemeToggle.tsx # Переключатель темы
│   │   │   └── ...
│   │   ├── pages/              # Страницы приложения
│   │   │   ├── Games.tsx       # Страница игр
│   │   │   ├── GameRoom.tsx    # Детали игровой комнаты
│   │   │   ├── Leaderboard.tsx # Таблица лидеров
│   │   │   └── Profile.tsx     # Профиль пользователя
│   │   ├── api.ts              # API клиент
│   │   ├── types.ts            # TypeScript типы
│   │   ├── App.tsx             # Корневой компонент приложения
│   │   └── main.tsx            # Точка входа
│   └── ...
└── TG_miniApp_back/            # Бэкенд на Flask
    ├── main.py                 # Основной файл приложения
    ├── locations.py            # Данные о локациях
    ├── migrations/             # Миграции базы данных
    └── ...
```

## Модели данных

### Пользователь (User)
- ID
- Имя пользователя
- URL фото
- Очки
- Количество игр
- Количество побед
- Настройки темы оформления

### Игровая комната (GameRoom)
- ID
- Название
- Создатель
- Максимальное количество игроков
- Локация
- Временной диапазон
- Статус (ожидание, выбор команд, в процессе, ввод счета, завершена)
- Игроки команд А и B
- Капитаны команд
- Счет команд
- Статус ввода счета

### История игр (GameHistory)
- ID
- Пользователь
- Игровая комната
- Победитель
- Команда
- Счет
- Роль капитана
- Результат
- Заработанные очки
- Дата игры
- Время начала и конца игры

## Установка и запуск

### Требования
- Python 3.8+
- Node.js 16+
- npm или yarn
- PostgreSQL

### Настройка базы данных
1. Создайте базу данных PostgreSQL:

```bash
# Подключитесь к PostgreSQL
psql -U postgres

# Создайте базу данных
CREATE DATABASE tg_miniapp;

# Выйдите из psql
\q
```

2. Настройте переменные окружения:

Создайте файл `.env` в директории бэкенда со следующим содержимым:

```
DATABASE_URL=postgresql://postgres:footbot777Azat@localhost/mydb
FLASK_APP=main.py
FLASK_ENV=development
```

Измените параметры подключения к базе данных, если необходимо.

### Установка и запуск бэкенда
```bash
# Переходим в директорию бэкенда
cd footbot/TG_miniApp_back

# Создаем виртуальное окружение
python -m venv venv

# Активируем виртуальное окружение
# На Windows:
venv\Scripts\activate
# На Linux/Mac:
source venv/bin/activate

# Устанавливаем зависимости
pip install -r requirements.txt

# Инициализируем миграции
flask db init
flask db migrate -m "Initial migration"
flask db upgrade

# Заполняем базу тестовыми данными (при первом запуске)
flask init-db

# Запускаем сервер разработки
flask run --debug
```

Сервер будет доступен по адресу http://localhost:5000.

### Установка и запуск фронтенда
```bash
# Переходим в директорию фронтенда
cd footbot/TG_miniApp_front

# Устанавливаем зависимости
npm install
# или
yarn install

# Запускаем сервер разработки
npm run dev
# или
yarn dev
```

## API Endpoints

### Пользователи
- `GET /api/users` - Получение списка всех пользователей
- `GET /api/users/{id}` - Получение пользователя по ID
- `GET /api/users/me` - Получение текущего пользователя
- `GET /api/users/game-history` - Получение истории игр текущего пользователя
- `GET /api/users/{id}/game-history` - Получение истории игр конкретного пользователя
- `POST /api/users/theme-preference` - Установка предпочтений темы пользователя

### Игровые комнаты
- `GET /api/game-rooms` - Получение списка игровых комнат
- `GET /api/game-rooms/{id}` - Получение игровой комнаты по ID
- `POST /api/game-rooms` - Создание игровой комнаты
- `POST /api/game-rooms/{id}/join` - Присоединение к игровой комнате
- `POST /api/game-rooms/{id}/leave` - Выход из игровой комнаты
- `DELETE /api/game-rooms/{id}` - Удаление игровой комнаты
- `POST /api/game-rooms/{id}/start-team-selection` - Начало выбора хуев
- `POST /api/game-rooms/{id}/start-game` - Начало игры
- `POST /api/game-rooms/{id}/end-game` - Завершение игры
- `POST /api/game-rooms/{id}/submit-score` - Ввод счета игры

### Прочее
- `GET /api/leaderboard` - Получение таблицы лидеров
- `GET /api/user-active-rooms` - Получение активных комнат пользователя
- `GET /api/locations/search` - Поиск локаций
- `GET /api/locations` - Получение всех локаций
- `POST /api/game-rooms/{id}/report-player` - Жалоба на игрока

## Системы расчета очков

В FootBot используется специальная система начисления очков:

1. **Победа**: +10-30 очков (в зависимости от сложности матча)
2. **Ничья**: 0 очков
3. **Поражение**: -5-20 очков (в зависимости от разницы в счете)

Дополнительно применяются штрафы:
- Несоответствие счета между капитанами: штраф для капитанов
- Система учитывает повторные нарушения и увеличивает штрафы

## Особенности и функциональность

### Создание игр
1. Пользователь создает игровую комнату, указывая название, место, время и максимальное количество игроков
2. Другие игроки могут присоединиться к комнате
3. Когда набирается достаточно игроков, создатель может начать выбор команд
4. После формирования команд, начинается игра

### Завершение игр
1. Любой из капитанов команд может завершить игру
2. После завершения капитаны вводят счет
3. Система сравнивает введенный счет:
   - При совпадении: результат подтверждается, очки распределяются
   - При несовпадении: капитаны получают штраф и должны ввести счет повторно

### Таблица лидеров
Таблица лидеров формируется на основе заработанных очков и позволяет отслеживать:
- Топ игроков
- Количество игр
- Соотношение побед к общему количеству игр
- Детальную статистику каждого игрока

## Разработка и вклад в проект

### Запуск тестовой среды
Для тестирования можно использовать Telegram Bot Father для создания тестового бота и мини-приложения.

### Отладка
- Для фронтенда: консоль браузера и React DevTools
- Для бэкенда: логи Flask и отладочные сообщения в терминале

### Внесение изменений
1. Создайте fork проекта
2. Внесите изменения
3. Отправьте pull request с описанием изменений

## Лицензия

Проект распространяется под лицензией MIT. См. файл LICENSE для получения дополнительной информации.

## Контакты

По всем вопросам обращайтесь [ссылка на контактную информацию].